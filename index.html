<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QR Attendance - WordPress Integration Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #f0f0f7; /* Dashboard BG */
        color: #374151; /* gray-700 */
        scroll-behavior: smooth;
      }
      .pm-text { font-family: 'Inter', sans-serif; font-weight: 800; font-size: 32px; letter-spacing: -1px; }
      .step-card {
        background-color: #ffffff;
        border: 1px solid #e2e8f0; /* slate-200 */
        border-radius: 0.5rem;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        height: 100%;
        box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
      }
      .step-number {
        background-color: #46489A; /* Dashboard Purple */
        color: white;
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 9999px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1.125rem;
        margin-bottom: 1rem;
        flex-shrink: 0;
      }
      /* Style for code block */
      pre code {
        display: block;
        padding: 0;
        font-family: 'Roboto Mono', monospace;
        font-size: 0.875rem;
        color: #334155; /* slate-700 */
        white-space: pre-wrap;
        word-break: break-all;
        background-color: transparent;
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "html5-qrcode": "https://aistudiocdn.com/html5-qrcode@^2.3.8"
  }
}
</script>
</head>
  <body>
    <div class="container mx-auto px-4 py-8 sm:py-12 lg:py-16 max-w-5xl">
      
      <!-- Header Section -->
      <header class="text-center mb-16">
        <div class="flex items-center justify-center gap-4 mb-4">
          <img src="https://ponsrischool.in/wp-content/uploads/2025/03/cropped-download.png" alt="PM SHRI Prathmik Vidhyamandir Ponsri Logo" class="h-20 w-20">
        </div>
        <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-900 tracking-tight mb-2">
          PM SHRI Prathmik Vidhyamandir Ponsri
        </h1>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto">
          QR Code Attendance System for WP School Management
        </p>
      </header>

      <!-- How It Works Section -->
      <section class="mb-16">
        <h2 class="text-3xl font-bold text-center mb-10 text-gray-800">The Complete Workflow</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
          <!-- Step 1: Generate -->
          <div class="flex flex-col items-center">
            <div class="flex items-center justify-center h-16 w-16 rounded-full bg-white border border-gray-200 shadow-sm mb-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-indigo-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 012-2h4a2 2 0 012 2v1m-4 0h4" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 14h.01" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 14h.01" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 14h.01" />
              </svg>
            </div>
            <h3 class="font-bold text-lg mb-2 text-gray-900">1. Print ID Cards</h3>
            <p class="text-gray-600 text-sm max-w-xs mx-auto">
              Go to **Students &rarr; Bulk Print ID Cards**, select a class, and generate printable ID cards for all students in one go.
            </p>
          </div>
          <!-- Step 2: Scan -->
          <div class="flex flex-col items-center">
            <div class="flex items-center justify-center h-16 w-16 rounded-full bg-white border border-gray-200 shadow-sm mb-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-indigo-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v1m6 11h-1m-1 6v-1M4 12H3m1 6l-1-1M4 6l1 1m15 0l-1 1M9 4h6a2 2 0 012 2v6m-8 8H5a2 2 0 01-2-2V9a2 2 0 012-2h6" />
              </svg>
            </div>
            <h3 class="font-bold text-lg mb-2 text-gray-900">2. Scan Attendance</h3>
            <p class="text-gray-600 text-sm max-w-xs mx-auto">
              Navigate to the **Attendance &rarr; Scan Attendance** menu in WordPress to launch the scanner on any device with a camera.
            </p>
          </div>
          <!-- Step 3: Sync -->
          <div class="flex flex-col items-center">
            <div class="flex items-center justify-center h-16 w-16 rounded-full bg-white border border-gray-200 shadow-sm mb-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-indigo-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M12 11v6m0 0l-2-2m2 2l2-2" />
              </svg>
            </div>
            <h3 class="font-bold text-lg mb-2 text-gray-900">3. Sync to Dashboard</h3>
            <p class="text-gray-600 text-sm max-w-xs mx-auto">
              Attendance is instantly and automatically uploaded to your WP School Management dashboard. No manual entry needed.
            </p>
          </div>
        </div>
      </section>

      <!-- Live Demo Section -->
      <section class="mb-16">
        <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">Live Demo</h2>
        <div id="wpsm-qr-attendance-app">
          <!-- The React app will be mounted here. -->
        </div>
      </section>

      <!-- Installation Guide Section -->
      <section class="mb-16">
        <h2 class="text-3xl font-bold text-center mb-10 text-gray-800">How to Create & Install Your Plugin</h2>
        
        <!-- Part 1: Create the ZIP -->
        <div class="max-w-3xl mx-auto mb-12">
            <h3 class="text-xl font-bold text-center mb-6 text-gray-700">Part 1: Create the Plugin <code>.zip</code> File</h3>
            <div class="space-y-6">
                <!-- Step 1 -->
                <div class="flex items-start gap-4 p-4 bg-white border border-slate-200 rounded-lg shadow-sm">
                    <div class="step-number mt-1">1</div>
                    <div>
                        <h4 class="font-bold text-lg text-gray-900">Create the File</h4>
                        <p class="text-gray-600">On your computer, create a new file and name it exactly: <code>wpsm-qr-attendance.php</code></p>
                    </div>
                </div>
                <!-- Step 2 -->
                <div class="flex items-start gap-4 p-4 bg-white border border-slate-200 rounded-lg shadow-sm">
                    <div class="step-number mt-1">2</div>
                    <div>
                        <h4 class="font-bold text-lg text-gray-900">Paste the Code</h4>
                        <p class="text-gray-600 mb-4">Copy the complete PHP code below and paste it into the file you just created.</p>
                        <!-- Code Block nested here -->
                        <div class="bg-slate-50 border border-slate-200 rounded-lg relative">
                            <div class="px-4 py-2 border-b border-slate-200 text-xs text-slate-500 flex justify-between items-center">
                              <span>wpsm-qr-attendance.php</span>
                              <button id="copy-plugin-code-btn" class="inline-flex items-center px-3 py-1 bg-slate-200 hover:bg-slate-300 text-slate-700 text-xs font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-50 focus:ring-indigo-500">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                                <span id="copy-plugin-btn-text">Copy Code</span>
                              </button>
                            </div>
                            <div class="p-4 overflow-x-auto max-h-96">
                              <pre><code id="plugin-code-snippet" class="language-php">
&lt;?php
/**
 * Plugin Name:       WP School Management - QR Attendance
 * Description:       A seamless QR code attendance solution for PM SHRI Schools, fully integrated with the WP School Management plugin.
 * Version:           1.4.0
 * Author:            AI Assistant
 * License:           GPL-2.0-or-later
 * License URI:       https://www.gnu.org/licenses/gpl-2.0.html
 * Text Domain:       wpsm-qr-attendance
 */

if ( ! defined( 'ABSPATH' ) ) exit;

// 1. Add Admin Menu Pages
add_action( 'admin_menu', function() {
    // Page for the Scanner
    add_submenu_page( 'wpsm-attendance', 'Scan Attendance', 'Scan Attendance', 'manage_options', 'wpsm-scan-attendance', 'wpsm_qr_scanner_page_render' );
    // Page for Bulk Printing ID Cards - Placed under Students for better UX
    add_submenu_page( 'wpsm-students', 'Bulk Print ID Cards', 'Bulk Print ID Cards', 'manage_options', 'wpsm-bulk-print-ids', 'wpsm_qr_bulk_print_page_render' );
});

function wpsm_qr_scanner_page_render() {
    echo '&lt;div class="wrap"&gt;&lt;div id="wpsm-qr-attendance-app"&gt;&lt;/div&gt;&lt;/div&gt;';
}

// 2. Enqueue Scripts for the Scanner App
add_action( 'admin_enqueue_scripts', function( $hook ) {
    if ( 'attendance_page_wpsm-scan-attendance' !== $hook ) return;
    $script_url = 'https://aistudio.google.com/app/index.js'; // In a real plugin, you would bundle this.
    wp_enqueue_script( 'wpsm-qr-attendance-app', $script_url, ['wp-element'], '1.4.0', true );
    wp_localize_script( 'wpsm-qr-attendance-app', 'qrAttendanceData', [
        'apiUrl'   => rest_url( 'wpsm-qr-attendance/v1/log' ),
        'nonce'    => wp_create_nonce( 'wp_rest' ),
        'is_admin' => current_user_can( 'manage_options' ),
    ]);
});

// 3. Register REST API Endpoint
add_action( 'rest_api_init', function () {
    register_rest_route( 'wpsm-qr-attendance/v1', '/log', [
        'methods'  => 'POST',
        'callback' => 'wpsm_qr_log_attendance_callback',
        'permission_callback' => fn() => current_user_can( 'manage_options' )
    ]);
});

// 4. Handle Incoming Attendance Data
function wpsm_qr_log_attendance_callback( WP_REST_Request $request ) {
    $params = $request->get_json_params();
    $qr_data_string = sanitize_text_field( $params['qrData'] ?? '' );
    $mode = sanitize_text_field( $params['mode'] ?? '' );
    if ( empty($qr_data_string) || empty($mode) ) return new WP_Error( 'bad_request', 'Missing data.', ['status' => 400] );
    
    $qr_data = json_decode( html_entity_decode( $qr_data_string ), true );
    if ( !is_array($qr_data) || !isset($qr_data['id']) ) return new WP_Error( 'invalid_qr', 'Invalid QR format.', ['status' => 400] );
    
    $user_id = absint( $qr_data['id'] );
    // TODO: Add logic here to save attendance into WP School Management database.
    return new WP_REST_Response( [ 'success' => true, 'message' => "Attendance for {$mode} ID: {$user_id} logged.", 'attendanceStatus' => 'On Time' ], 200 );
}

// 5. Display Rich ID Card on User Profile
add_action( 'edit_user_profile', 'wpsm_qr_display_id_card_section' );
function wpsm_qr_display_id_card_section( $user ) {
    if ( ! current_user_can( 'manage_options' ) ) return;
    ?&gt;
    &lt;h3&gt;QR Attendance ID Card&lt;/h3&gt;
    &lt;table class="form-table"&gt;&lt;tr&gt;&lt;th&gt;&lt;label&gt;ID Card&lt;/label&gt;&lt;/th&gt;&lt;td&gt;
    &lt;?php wpsm_qr_render_single_id_card($user); ?&gt;
    &lt;p class="description"&gt;Use the browser's print function (Ctrl/Cmd+P) to print this ID card.&lt;/p&gt;
    &lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
    &lt;?php
}

// 6. Bulk Print Page Renderer
function wpsm_qr_bulk_print_page_render() {
    ?&gt;
    &lt;div class="wrap"&gt;
        &lt;h1&gt;Bulk Print Student ID Cards&lt;/h1&gt;
        &lt;p&gt;Select a class to generate printable ID cards for all students.&lt;/p&gt;
        &lt;form method="POST" class="wpsm-qr-print-form"&gt;
            &lt;?php
            // Mock function - in a real scenario, this would get classes from the main plugin.
            $classes = ['Class A', 'Class B', 'Class C']; 
            ?&gt;
            &lt;label for="wpsm_class_select"&gt;Select Class:&lt;/label&gt;
            &lt;select name="wpsm_class_select" id="wpsm_class_select"&gt;
                &lt;option value=""&gt;-- Select a Class --&lt;/option&gt;
                &lt;?php foreach ($classes as $class) : ?&gt;
                    &lt;option value="&lt;?php echo esc_attr($class); ?&gt;"&gt;&lt;?php echo esc_html($class); ?&gt;&lt;/option&gt;
                &lt;?php endforeach; ?&gt;
            &lt;/select&gt;
            &lt;input type="submit" name="generate_id_cards" class="button button-primary" value="Generate"&gt;
        &lt;/form&gt;
        &lt;hr/&gt;
        &lt;div class="wpsm-qr-id-cards-container"&gt;
            &lt;?php
            if ( isset($_POST['generate_id_cards']) && !empty($_POST['wpsm_class_select']) ) {
                $selected_class = sanitize_text_field($_POST['wpsm_class_select']);
                echo "&lt;h2&gt;ID Cards for " . esc_html($selected_class) . "&lt;/h2&gt;";
                echo '&lt;p&gt;Use your browser\'s print function (Ctrl/Cmd + P) to print these cards.&lt;/p&gt;';
                
                // Mock: Get users for the selected class. Replace with actual query.
                $students = get_users( ['role' => 'student', 'number' => 10] ); // Placeholder
                
                if (empty($students)) {
                    echo '&lt;p&gt;No students found for this class.&lt;/p&gt;';
                } else {
                    foreach ($students as $student) {
                        wpsm_qr_render_single_id_card($student);
                    }
                }
            }
            ?&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;?php
    wpsm_qr_id_card_styles(); // Inject CSS
}

// 7. Reusable function to render a single ID card HTML
function wpsm_qr_render_single_id_card( $user ) {
    $user_id = $user-&gt;ID;
    $qr_data = json_encode(['id' => $user_id, 'name' => $user-&gt;display_name]);
    $qr_code_url = 'https://api.qrserver.com/v1/create-qr-code/?size=120x120&amp;data=' . urlencode($qr_data);
    $school_logo_url = 'https://ponsrischool.in/wp-content/uploads/2025/03/cropped-download.png';
    
    // Get user meta - replace with actual meta keys from WP School Management
    $dob = get_user_meta( $user_id, 'dob', true ) ?: 'N/A';
    $mobile = get_user_meta( $user_id, 'mobile_number', true ) ?: 'N/A';
    $photo_url = get_avatar_url( $user_id, ['size' => 150] );
    ?&gt;
    &lt;div class="wpsm-id-card"&gt;
        &lt;div class="id-card-header"&gt;
            &lt;img src="&lt;?php echo esc_url($school_logo_url); ?&gt;" alt="School Logo"&gt;
            &lt;span&gt;PM SHRI PRATHMIK&lt;br&gt;VIDHYAMANDIR PONSRI&lt;/span&gt;
        &lt;/div&gt;
        &lt;div class="id-card-body"&gt;
            &lt;div class="id-card-photo"&gt;
                &lt;img src="&lt;?php echo esc_url( $photo_url ); ?&gt;" alt="&lt;?php echo esc_attr( $user-&gt;display_name ); ?&gt;"&gt;
            &lt;/div&gt;
            &lt;div class="id-card-info"&gt;
                &lt;div class="id-card-name"&gt;&lt;?php echo esc_html( $user-&gt;display_name ); ?&gt;&lt;/div&gt;
                &lt;div class="id-card-details"&gt;
                    &lt;strong&gt;DOB:&lt;/strong&gt; &lt;?php echo esc_html( $dob ); ?&gt;&lt;br&gt;
                    &lt;strong&gt;Mobile:&lt;/strong&gt; &lt;?php echo esc_html( $mobile ); ?&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="id-card-qr"&gt;
                &lt;img src="&lt;?php echo esc_url($qr_code_url); ?&gt;" alt="QR Code"&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;?php
}

// 8. Function to add CSS for ID cards and print layout
function wpsm_qr_id_card_styles() {
    ?&gt;
    &lt;style type="text/css"&gt;
        .wpsm-id-card {
            width: 320px;
            height: 200px;
            border: 1px solid #ccc;
            border-radius: 10px;
            font-family: sans-serif;
            display: inline-block;
            margin: 10px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            page-break-inside: avoid;
        }
        .id-card-header { 
            background-color: #46489A; 
            color: white; 
            font-weight: bold; 
            padding: 8px 10px; 
            font-size: 10px; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            line-height: 1.2; 
            text-align: left;
        }
        .id-card-header img {
            height: 30px;
            width: 30px;
        }
        .id-card-header span {
            flex-grow: 1;
        }
        .id-card-body { display: flex; padding: 10px; align-items: center; }
        .id-card-photo { flex-shrink: 0; margin-right: 10px; }
        .id-card-photo img { width: 80px; height: 80px; border-radius: 5px; border: 2px solid #ddd; object-fit: cover; }
        .id-card-info { flex-grow: 1; }
        .id-card-name { font-size: 16px; font-weight: bold; color: #333; }
        .id-card-details { font-size: 12px; color: #555; margin-top: 5px; line-height: 1.4; }
        .id-card-qr { flex-shrink: 0; }
        .id-card-qr img { width: 80px; height: 80px; }

        @media print {
            body { background-color: white; }
            .wpsm-qr-print-form, .wrap > h1, .wrap > p, .wrap > hr, .wrap > h2 { display: none; }
            .wpsm-qr-id-cards-container { margin-top: 0; }
            #wpadminbar, #adminmenumain, #wpfooter { display: none !important; }
            #wpcontent { margin-left: 0 !important; padding-top: 0 !important; }
            .wpsm-id-card { box-shadow: none; border: 1px solid #000; }
        }
    &lt;/style&gt;
    &lt;?php
}
              </code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                 <!-- Step 3 -->
                <div class="flex items-start gap-4 p-4 bg-white border border-slate-200 rounded-lg shadow-sm">
                    <div class="step-number mt-1">3</div>
                    <div>
                        <h4 class="font-bold text-lg text-gray-900">Zip the File</h4>
                        <p class="text-gray-600">Compress the <code>wpsm-qr-attendance.php</code> file into a <code>.zip</code> archive. On most systems, you can just right-click the file and choose "Compress" or "Send to &rarr; Compressed (zipped) folder".</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Part 2: Install in WordPress -->
        <div class="max-w-3xl mx-auto">
            <h3 class="text-xl font-bold text-center mb-6 text-gray-700">Part 2: Install in WordPress</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <!-- Step 4 -->
              <div class="step-card">
                <div class="step-number">4</div>
                <h3 class="font-bold text-lg mb-2 text-gray-900">Upload Plugin</h3>
                <p class="text-gray-600 text-sm">In WordPress, go to <strong>Plugins &rarr; Add New &rarr; Upload Plugin</strong> and select the <code>.zip</code> file you just created.</p>
              </div>
              <!-- Step 5 -->
              <div class="step-card">
                <div class="step-number">5</div>
                <h3 class="font-bold text-lg mb-2 text-gray-900">Activate</h3>
                <p class="text-gray-600 text-sm">After uploading, click the <strong>Activate Plugin</strong> button.</p>
              </div>
              <!-- Step 6 -->
              <div class="step-card">
                <div class="step-number">6</div>
                <h3 class="font-bold text-lg mb-2 text-gray-900">All Set!</h3>
                <p class="text-gray-600 text-sm">You can now bulk print cards from <strong>Students &rarr; Bulk Print ID Cards</strong> and scan from <strong>Attendance &rarr; Scan Attendance</strong>.</p>
              </div>
            </div>
        </div>
      </section>

      <!-- Manual Integration Section -->
      <section class="mt-16">
        <h2 class="text-3xl font-bold text-center mb-4 text-gray-800">Customize QR Code Data</h2>
        <p class="text-center text-gray-600 max-w-2xl mx-auto mb-8">
          For developers: add the following snippet to your theme's <code>functions.php</code> file to include extra data (like a student's class) in the QR codes.
        </p>
        <div class="max-w-3xl mx-auto">
          <div class="bg-slate-50 border border-slate-200 rounded-lg relative">
            <div class="px-4 py-2 border-b border-slate-200 text-xs text-slate-500 flex justify-between items-center">
              <span>PHP Snippet for functions.php</span>
              <button id="copy-code-btn" class="inline-flex items-center px-3 py-1 bg-slate-200 hover:bg-slate-300 text-slate-700 text-xs font-semibold rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-50 focus:ring-indigo-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                <span id="copy-btn-text">Copy</span>
              </button>
            </div>
            <div class="p-4 overflow-x-auto">
              <pre><code id="code-snippet" class="language-php">
&lt;?php
/**
 * Filter to customize QR code data in WP School Management.
 *
 * @param array  $data      The default data for the QR code (e.g., ['id' => 123]).
 * @param int    $user_id   The ID of the user (student/staff).
 * @param string $user_type The type of user ('student' or 'teacher').
 * @return array The modified data array.
 */
add_filter( 'wpsm_qr_attendance_data', function( $data, $user_id, $user_type ) {
    // Example: Add a custom 'class' meta field for students.
    if ( 'student' === $user_type ) {
        $class = get_user_meta( $user_id, 'class', true );
        if ( ! empty( $class ) ) {
            $data['class'] = $class;
        }
    }

    return $data;
}, 10, 3 );
              </code></pre>
            </div>
          </div>
        </div>
      </section>

    </div>

    <!-- 
      This script simulates the data that WordPress would provide via wp_localize_script.
      It defines the API endpoint and nonce required for the app to function for local development.
      In a real WordPress environment, this would be generated by the main plugin PHP file,
      and would also include an 'is_admin' flag (e.g., is_admin: true).
    -->
    <script>
      window.qrAttendanceData = {
        apiUrl: '/wp-json/wpsm-qr-attendance/v1/log', // Example API URL for local dev
        nonce: 'a1b2c3d4e5', // Example nonce for local dev
        is_admin: true // For the live demo, we assume the user is an admin. In WordPress, this is set dynamically.
      };
    </script>

    <script type="module" src="/index.tsx"></script>

    <!-- Script for copy-to-clipboard functionality -->
    <script>
      function setupCopyButton(buttonId, snippetId, textId) {
        const copyButton = document.getElementById(buttonId);
        if (copyButton) {
          const codeSnippet = document.getElementById(snippetId);
          const copyButtonText = document.getElementById(textId);
          const originalText = copyButtonText.textContent;

          copyButton.addEventListener('click', () => {
            if (!codeSnippet || !navigator.clipboard) { return; }
            
            // Decode HTML entities for copying
            const tempEl = document.createElement('textarea');
            tempEl.innerHTML = codeSnippet.textContent.trim();
            const codeToCopy = tempEl.value;

            navigator.clipboard.writeText(codeToCopy).then(() => {
              // Success feedback
              copyButtonText.textContent = 'Copied!';
              copyButton.classList.add('bg-green-600', 'hover:bg-green-600', 'text-white');
              copyButton.classList.remove('bg-slate-200', 'hover:bg-slate-300', 'text-slate-700');
              setTimeout(() => {
                copyButtonText.textContent = originalText;
                copyButton.classList.remove('bg-green-600', 'hover:bg-green-600', 'text-white');
                copyButton.classList.add('bg-slate-200', 'hover:bg-slate-300', 'text-slate-700');
              }, 2000);
            }).catch(err => {
              copyButtonText.textContent = 'Failed!';
              console.error('Failed to copy text: ', err);
              setTimeout(() => { copyButtonText.textContent = originalText; }, 2000);
            });
          });
        }
      }

      setupCopyButton('copy-code-btn', 'code-snippet', 'copy-btn-text');
      setupCopyButton('copy-plugin-code-btn', 'plugin-code-snippet', 'copy-plugin-btn-text');
    </script>
  </body>
</html>